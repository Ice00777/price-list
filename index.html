<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PriceList</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-color: #3498db;
            --secondary-color: #2c3e50;
            --background-color: #ffffff;
            --text-color: #333333;
            --card-background: #f8f9fa;
            --border-color: #dee2e6;
            --shadow-color: rgba(0, 0, 0, 0.1);
            --hover-color: #f0f0f0;
            --success-color: #2ecc71;
            --danger-color: #e74c3c;
            --warning-color: #f39c12;
            --admin-color: #9b59b6;
            --favorite-color: #e74c3c;
        }

        .dark-theme {
            --primary-color: #3498db;
            --secondary-color: #ecf0f1;
            --background-color: #121212;
            --text-color: #e0e0e0;
            --card-background: #1e1e1e;
            --border-color: #333333;
            --shadow-color: rgba(0, 0, 0, 0.3);
            --hover-color: #2a2a2a;
            --success-color: #27ae60;
            --danger-color: #c0392b;
            --warning-color: #d68910;
            --admin-color: #8e44ad;
            --favorite-color: #c0392b;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            transition: background-color 0.3s, color 0.3s;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        /* Header */
        header {
            background-color: var(--secondary-color);
            color: white;
            padding: 15px 0;
            box-shadow: 0 2px 10px var(--shadow-color);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .logo i {
            color: var(--primary-color);
        }

        nav ul {
            display: flex;
            list-style: none;
            gap: 25px;
        }

        nav a {
            color: white;
            text-decoration: none;
            font-weight: 500;
            padding: 8px 12px;
            border-radius: 4px;
            transition: background-color 0.2s;
        }

        nav a:hover, nav a.active {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .user-controls {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .theme-toggle {
            background: none;
            border: none;
            color: white;
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .theme-toggle:hover {
            background-color: rgba(255, 255, 255, 0.1);
        }

        .auth-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
        }

        .auth-btn:hover {
            background-color: #2980b9;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .admin-badge {
            background-color: var(--admin-color);
            color: white;
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        /* Main Content */
        .main-content {
            min-height: calc(100vh - 180px);
            padding: 30px 0;
        }

        .page {
            display: none;
        }

        .page.active {
            display: block;
        }

        .page-title {
            font-size: 2rem;
            margin-bottom: 20px;
            color: var(--primary-color);
        }

        /* Home Page */
        .search-section {
            margin-bottom: 30px;
        }

        .search-container {
            display: flex;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }

        .search-input {
            flex: 1;
            padding: 12px 15px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--card-background);
            color: var(--text-color);
        }

        .search-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
        }

        .search-btn:hover {
            background-color: #2980b9;
        }

        .filter-section {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .filter-btn {
            background-color: var(--card-background);
            border: 1px solid var(--border-color);
            padding: 8px 16px;
            border-radius: 20px;
            cursor: pointer;
            color: var(--text-color);
        }

        .filter-btn.active {
            background-color: var(--primary-color);
            color: white;
            border-color: var(--primary-color);
        }

        .products-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
        }

        .product-card {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
            transition: transform 0.2s, box-shadow 0.2s;
            position: relative;
        }

        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 6px 12px var(--shadow-color);
        }

        .product-header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 15px;
        }

        .product-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 5px;
        }

        .product-category {
            color: var(--primary-color);
            font-size: 0.9rem;
            margin-bottom: 10px;
        }

        .favorite-btn {
            background: none;
            border: none;
            color: var(--border-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
        }

        .favorite-btn.active {
            color: var(--favorite-color);
        }

        .price-comparison {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
        }

        .price-source {
            display: flex;
            flex-direction: column;
            align-items: center;
            flex: 1;
        }

        .price-source-name {
            font-size: 0.9rem;
            margin-bottom: 5px;
            color: var(--text-color);
        }

        .price-value {
            font-weight: bold;
            font-size: 1.1rem;
        }

        .price-best {
            color: var(--success-color);
        }

        .price-worst {
            color: var(--danger-color);
        }

        .price-source-logo {
            height: 24px;
            margin-bottom: 5px;
        }

        .product-actions {
            display: flex;
            gap: 10px;
            margin-top: 15px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 4px;
            border: none;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s;
            flex: 1;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #27ae60;
        }

        /* Auth Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1001;
            justify-content: center;
            align-items: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--background-color);
            border-radius: 8px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
            color: var(--text-color);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.5rem;
            color: var(--primary-color);
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            color: var(--text-color);
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
        }

        .form-input {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--border-color);
            border-radius: 4px;
            font-size: 1rem;
            background-color: var(--card-background);
            color: var(--text-color);
        }

        .form-error {
            color: var(--danger-color);
            font-size: 0.9rem;
            margin-top: 5px;
            display: none;
        }

        .form-error.active {
            display: block;
        }

        .auth-tabs {
            display: flex;
            border-bottom: 1px solid var(--border-color);
            margin-bottom: 20px;
        }

        .auth-tab {
            flex: 1;
            text-align: center;
            padding: 12px;
            cursor: pointer;
            font-weight: 500;
            border-bottom: 3px solid transparent;
        }

        .auth-tab.active {
            border-bottom-color: var(--primary-color);
            color: var(--primary-color);
        }

        .auth-form {
            display: none;
        }

        .auth-form.active {
            display: block;
        }

        /* Profile Page */
        .profile-container {
            display: flex;
            gap: 30px;
            flex-wrap: wrap;
        }

        .profile-sidebar {
            flex: 0 0 250px;
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .profile-main {
            flex: 1;
            min-width: 300px;
        }

        .profile-header {
            display: flex;
            align-items: center;
            gap: 20px;
            margin-bottom: 30px;
        }

        .profile-avatar {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background-color: var(--primary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2.5rem;
            font-weight: bold;
        }

        .profile-info h2 {
            font-size: 1.8rem;
            margin-bottom: 5px;
        }

        .profile-info p {
            color: var(--text-color);
            opacity: 0.8;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 20px;
            margin-top: 30px;
        }

        .stat-card {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .stat-value {
            font-size: 2rem;
            font-weight: bold;
            color: var(--primary-color);
            margin-bottom: 10px;
        }

        .stat-label {
            font-size: 0.9rem;
            color: var(--text-color);
            opacity: 0.8;
        }

        /* Cart Page */
        .cart-container {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .cart-item {
            display: flex;
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
            align-items: center;
            gap: 20px;
        }

        .cart-item-image {
            width: 100px;
            height: 100px;
            background-color: var(--primary-color);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 2rem;
        }

        .cart-item-details {
            flex: 1;
        }

        .cart-item-name {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 10px;
        }

        .cart-item-price {
            font-weight: bold;
            color: var(--primary-color);
            font-size: 1.1rem;
        }

        .cart-item-actions {
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .cart-total {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 4px 6px var(--shadow-color);
            text-align: right;
            font-size: 1.2rem;
            font-weight: bold;
        }

        .empty-cart {
            text-align: center;
            padding: 40px;
            color: var(--text-color);
            opacity: 0.7;
        }

        /* Admin Page */
        .admin-controls {
            display: flex;
            gap: 15px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .admin-section {
            background-color: var(--card-background);
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 30px;
            box-shadow: 0 4px 6px var(--shadow-color);
        }

        .admin-section h3 {
            margin-bottom: 20px;
            color: var(--primary-color);
            font-size: 1.5rem;
        }

        .users-table, .products-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 10px;
        }

        .users-table th, .users-table td,
        .products-table th, .products-table td {
            padding: 12px 15px;
            text-align: left;
            border-bottom: 1px solid var(--border-color);
        }

        .users-table th, .products-table th {
            background-color: rgba(0, 0, 0, 0.05);
            font-weight: 600;
        }

        .action-btn {
            padding: 6px 12px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            margin-right: 5px;
            font-size: 0.9rem;
        }

        .action-btn-edit {
            background-color: var(--warning-color);
            color: white;
        }

        .action-btn-delete {
            background-color: var(--danger-color);
            color: white;
        }

        /* Footer */
        footer {
            background-color: var(--secondary-color);
            color: white;
            padding: 30px 0;
            margin-top: 40px;
        }

        .footer-content {
            display: flex;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 30px;
        }

        .footer-section {
            flex: 1;
            min-width: 250px;
        }

        .footer-section h3 {
            margin-bottom: 15px;
            font-size: 1.3rem;
        }

        .footer-section ul {
            list-style: none;
        }

        .footer-section ul li {
            margin-bottom: 10px;
        }

        .footer-section a {
            color: white;
            text-decoration: none;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .footer-section a:hover {
            opacity: 1;
        }

        .support-email {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 15px;
            color: white;
            text-decoration: none;
            opacity: 0.8;
        }

        .support-email:hover {
            opacity: 1;
        }

        .copyright {
            text-align: center;
            margin-top: 30px;
            padding-top: 20px;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            opacity: 0.7;
            font-size: 0.9rem;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .header-content {
                flex-direction: column;
                gap: 15px;
            }
            
            nav ul {
                flex-wrap: wrap;
                justify-content: center;
            }
            
            .products-grid {
                grid-template-columns: 1fr;
            }
            
            .cart-item {
                flex-direction: column;
                text-align: center;
            }
            
            .profile-container {
                flex-direction: column;
            }
        }

        /* Notifications */
        .notification {
            position: fixed;
            bottom: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 4px;
            color: white;
            font-weight: 500;
            z-index: 1002;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            transform: translateY(100px);
            opacity: 0;
            transition: transform 0.3s, opacity 0.3s;
        }

        .notification.active {
            transform: translateY(0);
            opacity: 1;
        }

        .notification-success {
            background-color: var(--success-color);
        }

        .notification-error {
            background-color: var(--danger-color);
        }

        .notification-info {
            background-color: var(--primary-color);
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container header-content">
            <div class="logo">
                <i class="fas fa-balance-scale"></i>
                PriceList
            </div>
            <nav>
                <ul>
                    <li><a href="#" class="nav-link active" data-page="home">Главная</a></li>
                    <li><a href="#" class="nav-link" data-page="favorites">Избранное</a></li>
                    <li><a href="#" class="nav-link" data-page="cart">Корзина <span class="cart-count">0</span></a></li>
                    <li><a href="#" class="nav-link" data-page="profile">Профиль</a></li>
                    <li><a href="#" class="nav-link" data-page="admin" id="admin-link" style="display: none;">Админ-панель</a></li>
                </ul>
            </nav>
            <div class="user-controls">
                <button class="theme-toggle" id="theme-toggle">
                    <i class="fas fa-moon"></i>
                </button>
                <div class="user-info" id="user-info" style="display: none;">
                    <div class="user-avatar" id="user-avatar">U</div>
                    <span id="username"></span>
                    <div class="admin-badge" id="admin-badge" style="display: none;">Admin</div>
                </div>
                <button class="auth-btn" id="auth-btn">Войти</button>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="main-content container">
        <!-- Home Page -->
        <section class="page active" id="home-page">
            <h1 class="page-title">Сравнение цен на товары</h1>
            <div class="search-section">
                <div class="search-container">
                    <input type="text" class="search-input" id="search-input" placeholder="Поиск товаров...">
                    <button class="search-btn" id="search-btn"><i class="fas fa-search"></i> Найти</button>
                </div>
            </div>
            <div class="filter-section">
                <button class="filter-btn active" data-category="all">Все товары</button>
                <button class="filter-btn" data-category="electronics">Электроника</button>
                <button class="filter-btn" data-category="clothes">Одежда</button>
                <button class="filter-btn" data-category="home">Дом и сад</button>
                <button class="filter-btn" data-category="books">Книги</button>
            </div>
            <div class="products-grid" id="products-grid">
                <!-- Товары будут загружены через JavaScript -->
            </div>
        </section>

        <!-- Favorites Page -->
        <section class="page" id="favorites-page">
            <h1 class="page-title">Избранное</h1>
            <div class="products-grid" id="favorites-grid">
                <!-- Избранные товары будут загружены через JavaScript -->
            </div>
            <div class="empty-cart" id="empty-favorites" style="display: none;">
                <i class="fas fa-heart" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                <h3>В избранном пока ничего нет</h3>
                <p>Добавляйте товары в избранное, нажимая на значок сердца</p>
            </div>
        </section>

        <!-- Cart Page -->
        <section class="page" id="cart-page">
            <h1 class="page-title">Корзина</h1>
            <div class="cart-container" id="cart-container">
                <!-- Товары в корзине будут загружены через JavaScript -->
            </div>
            <div class="cart-total" id="cart-total" style="display: none;">
                Итого: <span id="total-price">0</span> руб.
                <button class="btn btn-success" style="margin-left: 20px;">Оформить заказ</button>
            </div>
            <div class="empty-cart" id="empty-cart">
                <i class="fas fa-shopping-cart" style="font-size: 3rem; margin-bottom: 20px; opacity: 0.5;"></i>
                <h3>Корзина пуста</h3>
                <p>Добавляйте товары в корзину, чтобы оформить заказ</p>
            </div>
        </section>

        <!-- Profile Page -->
        <section class="page" id="profile-page">
            <h1 class="page-title">Мой профиль</h1>
            <div class="profile-container">
                <div class="profile-sidebar">
                    <div class="profile-header">
                        <div class="profile-avatar" id="profile-avatar">U</div>
                        <div class="profile-info">
                            <h2 id="profile-name">Пользователь</h2>
                            <p id="profile-email">user@example.com</p>
                            <p id="profile-role">Покупатель</p>
                        </div>
                    </div>
                    <div style="margin-top: 20px;">
                        <button class="btn btn-primary" style="width: 100%;" id="edit-profile-btn">Редактировать профиль</button>
                        <button class="btn" style="width: 100%; margin-top: 10px; background-color: var(--card-background); color: var(--text-color);" id="logout-btn">Выйти</button>
                    </div>
                </div>
                <div class="profile-main">
                    <h3 style="margin-bottom: 20px;">Моя активность</h3>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value" id="favorites-count">0</div>
                            <div class="stat-label">Товаров в избранном</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="cart-items-count">0</div>
                            <div class="stat-label">Товаров в корзине</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="comparisons-count">0</div>
                            <div class="stat-label">Сравнений цен</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value" id="orders-count">0</div>
                            <div class="stat-label">Заказов</div>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Admin Page -->
        <section class="page" id="admin-page">
            <h1 class="page-title">Админ-панель</h1>
            <div class="admin-controls">
                <button class="btn btn-primary" id="add-product-btn">Добавить товар</button>
                <button class="btn" id="manage-users-btn" style="background-color: var(--admin-color); color: white;">Управление пользователями</button>
                <button class="btn" id="view-statistics-btn">Статистика</button>
            </div>
            
            <div class="admin-section" id="products-admin-section">
                <h3>Управление товарами</h3>
                <table class="products-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Название</th>
                            <th>Категория</th>
                            <th>Цена Ozon</th>
                            <th>Цена WB</th>
                            <th>Цена DNS</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="admin-products-table">
                        <!-- Товары для администрирования -->
                    </tbody>
                </table>
            </div>
            
            <div class="admin-section" id="users-admin-section" style="display: none;">
                <h3>Управление пользователями</h3>
                <table class="users-table">
                    <thead>
                        <tr>
                            <th>ID</th>
                            <th>Имя</th>
                            <th>Email</th>
                            <th>Роль</th>
                            <th>Дата регистрации</th>
                            <th>Действия</th>
                        </tr>
                    </thead>
                    <tbody id="admin-users-table">
                        <!-- Пользователи для администрирования -->
                    </tbody>
                </table>
            </div>
            
            <div class="admin-section" id="statistics-section" style="display: none;">
                <h3>Статистика</h3>
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value" id="total-users">0</div>
                        <div class="stat-label">Всего пользователей</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-products">0</div>
                        <div class="stat-label">Всего товаров</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-favorites">0</div>
                        <div class="stat-label">Добавлений в избранное</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value" id="total-cart-adds">0</div>
                        <div class="stat-label">Добавлений в корзину</div>
                    </div>
                </div>
            </div>
        </section>
    </main>

    <!-- Auth Modal -->
    <div class="modal" id="auth-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title">Вход / Регистрация</h2>
                <button class="close-modal" id="close-auth-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="auth-tabs">
                    <div class="auth-tab active" data-tab="login">Вход</div>
                    <div class="auth-tab" data-tab="register">Регистрация</div>
                </div>
                <form class="auth-form active" id="login-form">
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="login-email" placeholder="Введите email">
                        <div class="form-error" id="login-email-error">Введите корректный email</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" class="form-input" id="login-password" placeholder="Введите пароль">
                        <div class="form-error" id="login-password-error">Введите пароль</div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Войти</button>
                </form>
                <form class="auth-form" id="register-form">
                    <div class="form-group">
                        <label class="form-label">Имя</label>
                        <input type="text" class="form-input" id="register-name" placeholder="Введите ваше имя">
                        <div class="form-error" id="register-name-error">Введите имя</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-input" id="register-email" placeholder="Введите email">
                        <div class="form-error" id="register-email-error">Введите корректный email</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Пароль</label>
                        <input type="password" class="form-input" id="register-password" placeholder="Введите пароль">
                        <div class="form-error" id="register-password-error">Пароль должен содержать не менее 6 символов</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Подтвердите пароль</label>
                        <input type="password" class="form-input" id="register-confirm-password" placeholder="Подтвердите пароль">
                        <div class="form-error" id="register-confirm-password-error">Пароли не совпадают</div>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;">Зарегистрироваться</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Add/Edit Product Modal -->
    <div class="modal" id="product-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2 class="modal-title" id="product-modal-title">Добавить товар</h2>
                <button class="close-modal" id="close-product-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="product-form">
                    <div class="form-group">
                        <label class="form-label">Название товара</label>
                        <input type="text" class="form-input" id="product-name" placeholder="Введите название товара">
                        <div class="form-error" id="product-name-error">Введите название товара</div>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Категория</label>
                        <select class="form-input" id="product-category">
                            <option value="electronics">Электроника</option>
                            <option value="clothes">Одежда</option>
                            <option value="home">Дом и сад</option>
                            <option value="books">Книги</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Цена на Ozon (руб.)</label>
                        <input type="number" class="form-input" id="product-price-ozon" placeholder="Введите цену">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Цена на Wildberries (руб.)</label>
                        <input type="number" class="form-input" id="product-price-wb" placeholder="Введите цену">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Цена на DNS (руб.)</label>
                        <input type="number" class="form-input" id="product-price-dns" placeholder="Введите цену">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Описание товара</label>
                        <textarea class="form-input" id="product-description" rows="3" placeholder="Введите описание товара"></textarea>
                    </div>
                    <button type="submit" class="btn btn-primary" style="width: 100%;" id="save-product-btn">Сохранить товар</button>
                </form>
            </div>
        </div>
    </div>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>PriceList</h3>
                    <p>Сравнение цен на товары с ведущих маркетплейсов: Ozon, Wildberries, DNS.</p>
                </div>
                <div class="footer-section">
                    <h3>Навигация</h3>
                    <ul>
                        <li><a href="#" class="nav-link" data-page="home">Главная</a></li>
                        <li><a href="#" class="nav-link" data-page="favorites">Избранное</a></li>
                        <li><a href="#" class="nav-link" data-page="cart">Корзина</a></li>
                        <li><a href="#" class="nav-link" data-page="profile">Профиль</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h3>Поддержка</h3>
                    <p>Есть вопросы или предложения? Напишите нам!</p>
                    <a href="mailto:support@pricelist.ru" class="support-email">
                        <i class="fas fa-envelope"></i> support@pricelist.ru
                    </a>
                </div>
            </div>
            <div class="copyright">
                &copy; 2026 PriceList. Все права защищены.
            </div>
        </div>
    </footer>

    <script>
        // Инициализация приложения
        document.addEventListener('DOMContentLoaded', function() {
            // Инициализация данных
            initializeData();
            
            // Инициализация темной темы
            initializeTheme();
            
            // Инициализация навигации
            initializeNavigation();
            
            // Инициализация модальных окон
            initializeModals();
            
            // Инициализация форм
            initializeForms();
            
            // Инициализация страниц
            initializePages();
            
            // Загрузка продуктов
            loadProducts();
            
            // Обновление UI в зависимости от состояния авторизации
            updateUIForAuthState();
        });
        
        // База данных в localStorage
        let db = {
            users: [],
            products: [],
            favorites: {},
            cart: {},
            statistics: {
                totalUsers: 0,
                totalProducts: 0,
                totalFavorites: 0,
                totalCartAdds: 0
            }
        };
        
        // Текущий пользователь
        let currentUser = null;
        
        // Администратор по умолчанию
        const ADMIN_EMAIL = "admin@pricelist.ru";
        const ADMIN_PASSWORD = "admin123";
        const ADMIN_NAME = "Администратор";
        
        // Инициализация данных
        function initializeData() {
            // Загрузка данных из localStorage
            const savedData = localStorage.getItem('priceListDB');
            if (savedData) {
                db = JSON.parse(savedData);
            } else {
                // Инициализация начальных данных
                initializeDefaultData();
                saveData();
            }
            
            // Загрузка текущего пользователя
            const savedUser = sessionStorage.getItem('currentUser');
if (savedUser) {
    currentUser = JSON.parse(savedUser);
}            
            // Загрузка темы
            const savedTheme = localStorage.getItem('theme');
            if (savedTheme === 'dark') {
                document.body.classList.add('dark-theme');
                document.getElementById('theme-toggle').innerHTML = '<i class="fas fa-sun"></i>';
            }
        }
        
        // Инициализация начальных данных
        function initializeDefaultData() {
            // Добавление администратора
            db.users = [
                {
                    id: 1,
                    name: ADMIN_NAME,
                    email: ADMIN_EMAIL,
                    password: ADMIN_PASSWORD,
                    role: 'admin',
                    registrationDate: new Date().toISOString(),
                    favorites: [],
                    cart: []
                }
            ];
            
            // Добавление тестовых пользователей
            db.users.push({
                id: 2,
                name: "Иван Петров",
                email: "user1@example.com",
                password: "user123",
                role: 'user',
                registrationDate: new Date().toISOString(),
                favorites: [],
                cart: []
            });
            
            // Добавление тестовых товаров
            db.products = [
                {
                    id: 1,
                    name: "Смартфон iPhone 14",
                    category: "electronics",
                    description: "Смартфон Apple iPhone 14 с OLED-дисплеем 6.1",
                    prices: {
                        ozon: 79990,
                        wb: 78999,
                        dns: 80990
                    },
                    addedDate: new Date().toISOString()
                },
                {
                    id: 2,
                    name: "Ноутбук ASUS VivoBook",
                    category: "electronics",
                    description: "Ноутбук ASUS VivoBook 15, 15.6, Intel Core i5",
                    prices: {
                        ozon: 54990,
                        wb: 53999,
                        dns: 55990
                    },
                    addedDate: new Date().toISOString()
                },
                {
                    id: 3,
                    name: "Футболка мужская",
                    category: "clothes",
                    description: "Хлопковая футболка мужская, черная",
                    prices: {
                        ozon: 1499,
                        wb: 1399,
                        dns: 1599
                    },
                    addedDate: new Date().toISOString()
                },
                {
                    id: 4,
                    name: "Книга 'Мастер и Маргарита'",
                    category: "books",
                    description: "Роман Михаила Булгакова в твердом переплете",
                    prices: {
                        ozon: 899,
                        wb: 849,
                        dns: 949
                    },
                    addedDate: new Date().toISOString()
                },
                {
                    id: 5,
                    name: "Кофемашина De'Longhi",
                    category: "home",
                    description: "Автоматическая кофемашина для дома",
                    prices: {
                        ozon: 32990,
                        wb: 31999,
                        dns: 33990
                    },
                    addedDate: new Date().toISOString()
                },
                {
                    id: 6,
                    name: "Наушники Sony WH-1000XM4",
                    category: "electronics",
                    description: "Беспроводные наушники с шумоподавлением",
                    prices: {
                        ozon: 24990,
                        wb: 23999,
                        dns: 25990
                    },
                    addedDate: new Date().toISOString()
                }
            ];
            
            // Инициализация статистики
            db.statistics = {
                totalUsers: db.users.length,
                totalProducts: db.products.length,
                totalFavorites: 0,
                totalCartAdds: 0
            };
        }
        
        // Сохранение данных в localStorage
        function saveData() {
            localStorage.setItem('priceListDB', JSON.stringify(db));
        }
        
        // Инициализация темы
        function initializeTheme() {
            const themeToggle = document.getElementById('theme-toggle');
            themeToggle.addEventListener('click', toggleTheme);
        }
        
        // Переключение темы
        function toggleTheme() {
            const body = document.body;
            const themeToggle = document.getElementById('theme-toggle');
            
            if (body.classList.contains('dark-theme')) {
                body.classList.remove('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-moon"></i>';
                localStorage.setItem('theme', 'light');
            } else {
                body.classList.add('dark-theme');
                themeToggle.innerHTML = '<i class="fas fa-sun"></i>';
                localStorage.setItem('theme', 'dark');
            }
        }
        
        // Инициализация навигации
        function initializeNavigation() {
            // Навигация по страницам
            const navLinks = document.querySelectorAll('.nav-link');
            navLinks.forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    const pageId = this.getAttribute('data-page');
                    switchPage(pageId);
                    
                    // Обновление активной ссылки
                    navLinks.forEach(link => link.classList.remove('active'));
                    this.classList.add('active');
                });
            });
            
            // Кнопка входа/выхода
            const authBtn = document.getElementById('auth-btn');
            authBtn.addEventListener('click', function() {
                if (currentUser) {
                    logout();
                } else {
                    openAuthModal();
                }
            });
        }
        
        // Переключение страниц
        function switchPage(pageId) {
            // Скрыть все страницы
            const pages = document.querySelectorAll('.page');
            pages.forEach(page => page.classList.remove('active'));
            
            // Показать выбранную страницу
            const activePage = document.getElementById(`${pageId}-page`);
            if (activePage) {
                activePage.classList.add('active');
                
                // Загрузить данные для страницы
                switch(pageId) {
                    case 'home':
                        loadProducts();
                        break;
                    case 'favorites':
                        loadFavorites();
                        break;
                    case 'cart':
                        loadCart();
                        break;
                    case 'profile':
                        loadProfile();
                        break;
                    case 'admin':
                        loadAdminPage();
                        break;
                }
            }
        }
        
        // Инициализация модальных окон
        function initializeModals() {
            // Модальное окно авторизации
            const authModal = document.getElementById('auth-modal');
            const closeAuthModal = document.getElementById('close-auth-modal');
            const authTabs = document.querySelectorAll('.auth-tab');
            
            // Переключение вкладок в модальном окне авторизации
            authTabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // Обновление активной вкладки
                    authTabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Показать соответствующую форму
                    document.querySelectorAll('.auth-form').forEach(form => form.classList.remove('active'));
                    document.getElementById(`${tabId}-form`).classList.add('active');
                });
            });
            
            // Закрытие модального окна авторизации
            closeAuthModal.addEventListener('click', () => {
                authModal.classList.remove('active');
            });
            
            // Модальное окно товара
            const productModal = document.getElementById('product-modal');
            const closeProductModal = document.getElementById('close-product-modal');
            
            // Закрытие модального окна товара
            closeProductModal.addEventListener('click', () => {
                productModal.classList.remove('active');
            });
            
            // Закрытие модальных окон при клике вне их
            window.addEventListener('click', (e) => {
                if (e.target === authModal) {
                    authModal.classList.remove('active');
                }
                if (e.target === productModal) {
                    productModal.classList.remove('active');
                }
            });
        }
        
        // Инициализация форм
        function initializeForms() {
            // Форма входа
            const loginForm = document.getElementById('login-form');
            loginForm.addEventListener('submit', function(e) {
                e.preventDefault();
                login();
            });
            
            // Форма регистрации
            const registerForm = document.getElementById('register-form');
            registerForm.addEventListener('submit', function(e) {
                e.preventDefault();
                register();
            });
            
            // Форма товара
            const productForm = document.getElementById('product-form');
            productForm.addEventListener('submit', function(e) {
                e.preventDefault();
                saveProduct();
            });
            
            // Кнопка добавления товара в админ-панели
            const addProductBtn = document.getElementById('add-product-btn');
            if (addProductBtn) {
                addProductBtn.addEventListener('click', function() {
                    openProductModal();
                });
            }
            
            // Кнопки управления админ-панелью
            const manageUsersBtn = document.getElementById('manage-users-btn');
            const viewStatisticsBtn = document.getElementById('view-statistics-btn');
            
            if (manageUsersBtn) {
                manageUsersBtn.addEventListener('click', function() {
                    document.getElementById('products-admin-section').style.display = 'none';
                    document.getElementById('users-admin-section').style.display = 'block';
                    document.getElementById('statistics-section').style.display = 'none';
                    loadUsersForAdmin();
                });
            }
            
            if (viewStatisticsBtn) {
                viewStatisticsBtn.addEventListener('click', function() {
                    document.getElementById('products-admin-section').style.display = 'none';
                    document.getElementById('users-admin-section').style.display = 'none';
                    document.getElementById('statistics-section').style.display = 'block';
                    loadStatistics();
                });
            }
            
            // Кнопка редактирования профиля
            const editProfileBtn = document.getElementById('edit-profile-btn');
            if (editProfileBtn) {
                editProfileBtn.addEventListener('click', function() {
                    alert('Редактирование профиля будет доступно в следующей версии!');
                });
            }
            
            // Кнопка выхода
            const logoutBtn = document.getElementById('logout-btn');
            if (logoutBtn) {
                logoutBtn.addEventListener('click', logout);
            }
        }
        
        // Инициализация страниц
        function initializePages() {
            // Поиск товаров
            const searchBtn = document.getElementById('search-btn');
            const searchInput = document.getElementById('search-input');
            
            if (searchBtn) {
                searchBtn.addEventListener('click', function() {
                    const searchTerm = searchInput.value.trim().toLowerCase();
                    filterProducts(searchTerm);
                });
            }
            
            if (searchInput) {
                searchInput.addEventListener('keyup', function(e) {
                    if (e.key === 'Enter') {
                        const searchTerm = searchInput.value.trim().toLowerCase();
                        filterProducts(searchTerm);
                    }
                });
            }
            
            // Фильтрация по категориям
            const filterBtns = document.querySelectorAll('.filter-btn');
            filterBtns.forEach(btn => {
                btn.addEventListener('click', function() {
                    const category = this.getAttribute('data-category');
                    
                    // Обновление активной кнопки
                    filterBtns.forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    
                    // Фильтрация товаров
                    filterProductsByCategory(category);
                });
            });
        }
        
        // Открытие модального окна авторизации
        function openAuthModal() {
            const authModal = document.getElementById('auth-modal');
            authModal.classList.add('active');
            
            // Сброс форм
            document.getElementById('login-email').value = '';
            document.getElementById('login-password').value = '';
            document.getElementById('register-name').value = '';
            document.getElementById('register-email').value = '';
            document.getElementById('register-password').value = '';
            document.getElementById('register-confirm-password').value = '';
        }
        
        // Вход в систему
        function login() {
            const email = document.getElementById('login-email').value.trim();
            const password = document.getElementById('login-password').value;
            
            // Валидация
            let isValid = true;
            
            if (!email) {
                document.getElementById('login-email-error').classList.add('active');
                isValid = false;
            } else {
                document.getElementById('login-email-error').classList.remove('active');
            }
            
            if (!password) {
                document.getElementById('login-password-error').classList.add('active');
                isValid = false;
            } else {
                document.getElementById('login-password-error').classList.remove('active');
            }
            
            if (!isValid) return;
            
            // Поиск пользователя
            const user = db.users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                sessionStorage.setItem('currentUser', JSON.stringify(user));
                
                // Закрытие модального окна
                document.getElementById('auth-modal').classList.remove('active');
                
                // Обновление UI
                updateUIForAuthState();
                
                // Уведомление
                showNotification('Вход выполнен успешно!', 'success');
                
                // Загрузка данных пользователя
                if (currentUser.role === 'admin') {
                    switchPage('admin');
                } else {
                    switchPage('profile');
                }
            } else {
                showNotification('Неверный email или пароль', 'error');
            }
        }
        
        // Регистрация
        function register() {
            const name = document.getElementById('register-name').value.trim();
            const email = document.getElementById('register-email').value.trim();
            const password = document.getElementById('register-password').value;
            const confirmPassword = document.getElementById('register-confirm-password').value;
            
            // Валидация
            let isValid = true;
            
            if (!name) {
                document.getElementById('register-name-error').classList.add('active');
                isValid = false;
            } else {
                document.getElementById('register-name-error').classList.remove('active');
            }
            
            if (!email) {
                document.getElementById('register-email-error').classList.add('active');
                isValid = false;
            } else {
                document.getElementById('register-email-error').classList.remove('active');
            }
            
            if (password.length < 6) {
                document.getElementById('register-password-error').classList.add('active');
                isValid = false;
            } else {
                document.getElementById('register-password-error').classList.remove('active');
            }
            
            if (password !== confirmPassword) {
                document.getElementById('register-confirm-password-error').classList.add('active');
                isValid = false;
            } else {
                document.getElementById('register-confirm-password-error').classList.remove('active');
            }
            
            if (!isValid) return;
            
            // Проверка, существует ли пользователь с таким email
            const userExists = db.users.some(u => u.email === email);
            
            if (userExists) {
                showNotification('Пользователь с таким email уже существует', 'error');
                return;
            }
            
            // Создание нового пользователя
            const newUser = {
                id: db.users.length + 1,
                name: name,
                email: email,
                password: password,
                role: 'user',
                registrationDate: new Date().toISOString(),
                favorites: [],
                cart: []
            };
            
            // Добавление пользователя в базу данных
            db.users.push(newUser);
            db.statistics.totalUsers++;
            
            // Сохранение данных
            saveData();
            
            // Автоматический вход
            currentUser = newUser;
            localStorage.setItem('currentUser', JSON.stringify(newUser));
            
            // Закрытие модального окна
            document.getElementById('auth-modal').classList.remove('active');
            
            // Обновление UI
            updateUIForAuthState();
            
            // Уведомление
            showNotification('Регистрация выполнена успешно!', 'success');
            
            // Переход на страницу профиля
            switchPage('profile');
        }
        
        // Выход из системы
        function logout() {
            currentUser = null;
            sessionStorage.removeItem('currentUser');
            
            // Обновление UI
            updateUIForAuthState();
            
            // Уведомление
            showNotification('Вы вышли из системы', 'info');
            
            // Переход на главную страницу
            switchPage('home');
        }
        
        // Обновление UI в зависимости от состояния авторизации
        function updateUIForAuthState() {
            const authBtn = document.getElementById('auth-btn');
            const userInfo = document.getElementById('user-info');
            const username = document.getElementById('username');
            const userAvatar = document.getElementById('user-avatar');
            const adminBadge = document.getElementById('admin-badge');
            const adminLink = document.getElementById('admin-link');
            const profileAvatar = document.getElementById('profile-avatar');
            const profileName = document.getElementById('profile-name');
            const profileEmail = document.getElementById('profile-email');
            const profileRole = document.getElementById('profile-role');
            
            if (currentUser) {
                // Пользователь авторизован
                authBtn.textContent = 'Выйти';
                
                // Обновление информации о пользователе
                const firstLetter = currentUser.name.charAt(0).toUpperCase();
                username.textContent = currentUser.name;
                userAvatar.textContent = firstLetter;
                userAvatar.style.backgroundColor = getRandomColor();
                
                // Показать информацию о пользователе
                userInfo.style.display = 'flex';
                
                // Показать/скрыть значок администратора
                if (currentUser.role === 'admin') {
                    adminBadge.style.display = 'block';
                    adminLink.style.display = 'block';
                } else {
                    adminBadge.style.display = 'none';
                    adminLink.style.display = 'none';
                }
                
                // Обновление информации в профиле
                if (profileAvatar) {
                    profileAvatar.textContent = firstLetter;
                    profileAvatar.style.backgroundColor = getRandomColor();
                }
                
                if (profileName) profileName.textContent = currentUser.name;
                if (profileEmail) profileEmail.textContent = currentUser.email;
                if (profileRole) profileRole.textContent = currentUser.role === 'admin' ? 'Администратор' : 'Покупатель';
            } else {
                // Пользователь не авторизован
                authBtn.textContent = 'Войти';
                userInfo.style.display = 'none';
                adminLink.style.display = 'none';
            }
        }
        
        // Загрузка продуктов
        function loadProducts() {
            const productsGrid = document.getElementById('products-grid');
            if (!productsGrid) return;
            
            productsGrid.innerHTML = '';
            
            db.products.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
            
            // Обновление счетчика товаров
            updateCartCount();
        }
        
        // Создание карточки товара
        function createProductCard(product) {
            const card = document.createElement('div');
            card.className = 'product-card';
            card.setAttribute('data-id', product.id);
            card.setAttribute('data-category', product.category);
            
            // Определение лучшей и худшей цены
            const prices = product.prices;
            const priceValues = Object.values(prices).filter(p => p > 0);
            const minPrice = Math.min(...priceValues);
            const maxPrice = Math.max(...priceValues);
            
            // Определение, добавлен ли товар в избранное
            const isFavorite = currentUser && currentUser.favorites && currentUser.favorites.includes(product.id);
            
            // Определение, добавлен ли товар в корзину
            const isInCart = currentUser && currentUser.cart && currentUser.cart.some(item => item.id === product.id);
            
            // Логотипы маркетплейсов (эмуляция)
            const ozonLogo = "OZON";
            const wbLogo = "WB";
            const dnsLogo = "DNS";
            
            card.innerHTML = `
                <div class="product-header">
                    <div>
                        <h3 class="product-name">${product.name}</h3>
                        <div class="product-category">${getCategoryName(product.category)}</div>
                    </div>
                    <button class="favorite-btn ${isFavorite ? 'active' : ''}" data-id="${product.id}">
                        <i class="fas fa-heart"></i>
                    </button>
                </div>
                <p style="margin-bottom: 15px; font-size: 0.9rem; opacity: 0.8;">${product.description}</p>
                <div class="price-comparison">
                    <div class="price-source">
                        <div class="price-source-logo">${ozonLogo}</div>
                        <div class="price-source-name">Ozon</div>
                        <div class="price-value ${prices.ozon === minPrice ? 'price-best' : (prices.ozon === maxPrice ? 'price-worst' : '')}">
                            ${prices.ozon ? prices.ozon.toLocaleString() + ' руб.' : 'Нет в наличии'}
                        </div>
                    </div>
                    <div class="price-source">
                        <div class="price-source-logo">${wbLogo}</div>
                        <div class="price-source-name">Wildberries</div>
                        <div class="price-value ${prices.wb === minPrice ? 'price-best' : (prices.wb === maxPrice ? 'price-worst' : '')}">
                            ${prices.wb ? prices.wb.toLocaleString() + ' руб.' : 'Нет в наличии'}
                        </div>
                    </div>
                    <div class="price-source">
                        <div class="price-source-logo">${dnsLogo}</div>
                        <div class="price-source-name">DNS</div>
                        <div class="price-value ${prices.dns === minPrice ? 'price-best' : (prices.dns === maxPrice ? 'price-worst' : '')}">
                            ${prices.dns ? prices.dns.toLocaleString() + ' руб.' : 'Нет в наличии'}
                        </div>
                    </div>
                </div>
                <div class="product-actions">
                    <button class="btn btn-primary add-to-cart-btn" data-id="${product.id}">
                        ${isInCart ? '<i class="fas fa-check"></i> В корзине' : '<i class="fas fa-shopping-cart"></i> В корзину'}
                    </button>
                    <button class="btn compare-btn" data-id="${product.id}">
                        <i class="fas fa-balance-scale"></i> Сравнить
                    </button>
                </div>
            `;
            
            // Добавление обработчиков событий
            const favoriteBtn = card.querySelector('.favorite-btn');
            favoriteBtn.addEventListener('click', function() {
                toggleFavorite(product.id);
            });
            
            const addToCartBtn = card.querySelector('.add-to-cart-btn');
            addToCartBtn.addEventListener('click', function() {
                addToCart(product.id);
            });
            
            const compareBtn = card.querySelector('.compare-btn');
            compareBtn.addEventListener('click', function() {
                compareProduct(product.id);
            });
            
            return card;
        }
        
        // Получение названия категории
        function getCategoryName(category) {
            const categories = {
                'electronics': 'Электроника',
                'clothes': 'Одежда',
                'home': 'Дом и сад',
                'books': 'Книги'
            };
            
            return categories[category] || category;
        }
        
        // Переключение избранного
        function toggleFavorite(productId) {
            if (!currentUser) {
                showNotification('Для добавления в избранное необходимо войти в систему', 'error');
                openAuthModal();
                return;
            }
            
            const favoriteBtn = document.querySelector(`.favorite-btn[data-id="${productId}"]`);
            const userIndex = db.users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex === -1) return;
            
            // Инициализация массива избранного, если его нет
            if (!db.users[userIndex].favorites) {
                db.users[userIndex].favorites = [];
            }
            
            const favorites = db.users[userIndex].favorites;
            const index = favorites.indexOf(productId);
            
            if (index === -1) {
                // Добавление в избранное
                favorites.push(productId);
                favoriteBtn.classList.add('active');
                db.statistics.totalFavorites++;
                showNotification('Товар добавлен в избранное', 'success');
            } else {
                // Удаление из избранного
                favorites.splice(index, 1);
                favoriteBtn.classList.remove('active');
                showNotification('Товар удален из избранного', 'info');
            }
            
            // Обновление текущего пользователя
            currentUser = db.users[userIndex];
            sessionStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Сохранение данных
            saveData();
            
            // Обновление счетчика избранного на странице профиля
            updateProfileStats();
        }
        
        // Добавление товара в корзину
        function addToCart(productId) {
            if (!currentUser) {
                showNotification('Для добавления в корзину необходимо войти в систему', 'error');
                openAuthModal();
                return;
            }
            
            const addToCartBtn = document.querySelector(`.add-to-cart-btn[data-id="${productId}"]`);
            const userIndex = db.users.findIndex(u => u.id === currentUser.id);
            
            if (userIndex === -1) return;
            
            // Инициализация корзины, если ее нет
            if (!db.users[userIndex].cart) {
                db.users[userIndex].cart = [];
            }
            
            const cart = db.users[userIndex].cart;
            const product = db.products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Проверка, есть ли товар уже в корзине
            const existingItem = cart.find(item => item.id === productId);
            
            if (!existingItem) {
                // Добавление товара в корзину
                cart.push({
                    id: productId,
                    name: product.name,
                    price: Math.min(...Object.values(product.prices).filter(p => p > 0)),
                    quantity: 1
                });
                
                addToCartBtn.innerHTML = '<i class="fas fa-check"></i> В корзине';
                db.statistics.totalCartAdds++;
                showNotification('Товар добавлен в корзину', 'success');
            } else {
                // Удаление товара из корзины
                const index = cart.findIndex(item => item.id === productId);
                if (index !== -1) {
                    cart.splice(index, 1);
                    addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> В корзину';
                    showNotification('Товар удален из корзины', 'info');
                }
            }
            
            // Обновление текущего пользователя
            currentUser = db.users[userIndex];
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Сохранение данных
            saveData();
            
            // Обновление счетчика корзины
            updateCartCount();
            
            // Обновление статистики профиля
            updateProfileStats();
        }
        
        // Сравнение товара
        function compareProduct(productId) {
            const product = db.products.find(p => p.id === productId);
            
            if (!product) return;
            
            // Определение лучшей цены
            const prices = product.prices;
            const priceValues = Object.values(prices).filter(p => p > 0);
            const minPrice = Math.min(...priceValues);
            
            // Определение маркетплейса с лучшей ценой
            let bestMarket = '';
            for (const [market, price] of Object.entries(prices)) {
                if (price === minPrice) {
                    switch(market) {
                        case 'ozon': bestMarket = 'Ozon'; break;
                        case 'wb': bestMarket = 'Wildberries'; break;
                        case 'dns': bestMarket = 'DNS'; break;
                    }
                    break;
                }
            }
            
            showNotification(`Лучшая цена на ${product.name}: ${minPrice.toLocaleString()} руб. на ${bestMarket}`, 'info');
            
            // Обновление статистики сравнений в профиле
            if (currentUser) {
                const userIndex = db.users.findIndex(u => u.id === currentUser.id);
                if (userIndex !== -1) {
                    if (!db.users[userIndex].comparisons) {
                        db.users[userIndex].comparisons = 0;
                    }
                    db.users[userIndex].comparisons = (db.users[userIndex].comparisons || 0) + 1;
                    
                    // Обновление текущего пользователя
                    currentUser = db.users[userIndex];
                    localStorage.setItem('currentUser', JSON.stringify(currentUser));
                    
                    // Сохранение данных
                    saveData();
                    
                    // Обновление статистики профиля
                    updateProfileStats();
                }
            }
        }
        
        // Обновление счетчика корзины
        function updateCartCount() {
            const cartCountElements = document.querySelectorAll('.cart-count');
            let totalCount = 0;
            
            if (currentUser && currentUser.cart) {
                totalCount = currentUser.cart.length;
            }
            
            cartCountElements.forEach(element => {
                element.textContent = totalCount;
            });
        }
        
        // Фильтрация товаров по поисковому запросу
        function filterProducts(searchTerm) {
            const products = db.products;
            const productsGrid = document.getElementById('products-grid');
            
            if (!productsGrid) return;
            
            productsGrid.innerHTML = '';
            
            if (!searchTerm) {
                // Если запрос пустой, показать все товары
                loadProducts();
                return;
            }
            
            // Фильтрация товаров
            const filteredProducts = products.filter(product => {
                return product.name.toLowerCase().includes(searchTerm) || 
                       product.description.toLowerCase().includes(searchTerm) ||
                       getCategoryName(product.category).toLowerCase().includes(searchTerm);
            });
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-color); opacity: 0.7;">Товары не найдены</p>';
                return;
            }
            
            // Отображение отфильтрованных товаров
            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
        }
        
        // Фильтрация товаров по категории
        function filterProductsByCategory(category) {
            const products = db.products;
            const productsGrid = document.getElementById('products-grid');
            
            if (!productsGrid) return;
            
            productsGrid.innerHTML = '';
            
            if (category === 'all') {
                // Если выбрана категория "Все", показать все товары
                loadProducts();
                return;
            }
            
            // Фильтрация товаров по категории
            const filteredProducts = products.filter(product => product.category === category);
            
            if (filteredProducts.length === 0) {
                productsGrid.innerHTML = '<p style="grid-column: 1 / -1; text-align: center; padding: 40px; color: var(--text-color); opacity: 0.7;">Товары не найдены</p>';
                return;
            }
            
            // Отображение отфильтрованных товаров
            filteredProducts.forEach(product => {
                const productCard = createProductCard(product);
                productsGrid.appendChild(productCard);
            });
        }
        
        // Загрузка избранного
        function loadFavorites() {
            const favoritesGrid = document.getElementById('favorites-grid');
            const emptyFavorites = document.getElementById('empty-favorites');
            
            if (!favoritesGrid || !emptyFavorites) return;
            
            favoritesGrid.innerHTML = '';
            
            if (!currentUser || !currentUser.favorites || currentUser.favorites.length === 0) {
                emptyFavorites.style.display = 'block';
                return;
            }
            
            emptyFavorites.style.display = 'none';
            
            // Загрузка избранных товаров
            currentUser.favorites.forEach(productId => {
                const product = db.products.find(p => p.id === productId);
                if (product) {
                    const productCard = createProductCard(product);
                    favoritesGrid.appendChild(productCard);
                }
            });
        }
        
        // Загрузка корзины
        function loadCart() {
            const cartContainer = document.getElementById('cart-container');
            const cartTotal = document.getElementById('cart-total');
            const emptyCart = document.getElementById('empty-cart');
            const totalPrice = document.getElementById('total-price');
            
            if (!cartContainer || !cartTotal || !emptyCart || !totalPrice) return;
            
            cartContainer.innerHTML = '';
            
            if (!currentUser || !currentUser.cart || currentUser.cart.length === 0) {
                emptyCart.style.display = 'block';
                cartTotal.style.display = 'none';
                return;
            }
            
            emptyCart.style.display = 'none';
            cartTotal.style.display = 'block';
            
            let total = 0;
            
            // Загрузка товаров в корзине
            currentUser.cart.forEach(cartItem => {
                const product = db.products.find(p => p.id === cartItem.id);
                if (product) {
                    const cartItemElement = document.createElement('div');
                    cartItemElement.className = 'cart-item';
                    cartItemElement.innerHTML = `
                        <div class="cart-item-image">
                            <i class="fas fa-box"></i>
                        </div>
                        <div class="cart-item-details">
                            <h3 class="cart-item-name">${product.name}</h3>
                            <div class="cart-item-price">${cartItem.price.toLocaleString()} руб. × ${cartItem.quantity} шт.</div>
                            <div style="margin-top: 10px; font-size: 0.9rem; opacity: 0.8;">Лучшая цена: ${cartItem.price.toLocaleString()} руб.</div>
                        </div>
                        <div class="cart-item-actions">
                            <button class="btn btn-primary update-quantity-btn" data-id="${product.id}">
                                <i class="fas fa-edit"></i> Изменить
                            </button>
                            <button class="btn action-btn-delete remove-from-cart-btn" data-id="${product.id}">
                                <i class="fas fa-trash"></i> Удалить
                            </button>
                        </div>
                    `;
                    
                    cartContainer.appendChild(cartItemElement);
                    
                    // Добавление к общей сумме
                    total += cartItem.price * cartItem.quantity;
                    
                    // Обработчики событий для кнопок в корзине
                    const removeBtn = cartItemElement.querySelector('.remove-from-cart-btn');
                    removeBtn.addEventListener('click', function() {
                        removeFromCart(product.id);
                    });
                    
                    const updateBtn = cartItemElement.querySelector('.update-quantity-btn');
                    updateBtn.addEventListener('click', function() {
                        updateQuantity(product.id);
                    });
                }
            });
            
            // Обновление общей суммы
            totalPrice.textContent = total.toLocaleString();
        }
        
        // Удаление товара из корзины
        function removeFromCart(productId) {
            if (!currentUser) return;
            
            const userIndex = db.users.findIndex(u => u.id === currentUser.id);
            if (userIndex === -1) return;
            
            const cart = db.users[userIndex].cart;
            const index = cart.findIndex(item => item.id === productId);
            
            if (index !== -1) {
                cart.splice(index, 1);
                
                // Обновление текущего пользователя
                currentUser = db.users[userIndex];
                localStorage.setItem('currentUser', JSON.stringify(currentUser));
                
                // Сохранение данных
                saveData();
                
                // Обновление UI
                updateCartCount();
                loadCart();
                updateProfileStats();
                
                // Обновление кнопок на карточках товаров
                const addToCartBtn = document.querySelector(`.add-to-cart-btn[data-id="${productId}"]`);
                if (addToCartBtn) {
                    addToCartBtn.innerHTML = '<i class="fas fa-shopping-cart"></i> В корзину';
                }
                
                showNotification('Товар удален из корзины', 'info');
            }
        }
        
        // Обновление количества товара в корзине
        function updateQuantity(productId) {
            if (!currentUser) return;
            
            const userIndex = db.users.findIndex(u => u.id === currentUser.id);
            if (userIndex === -1) return;
            
            const cart = db.users[userIndex].cart;
            const item = cart.find(item => item.id === productId);
            
            if (!item) return;
            
            const newQuantity = prompt(`Введите количество для товара "${item.name}":`, item.quantity);
            
            if (newQuantity === null) return;
            
            const quantity = parseInt(newQuantity);
            
            if (isNaN(quantity) || quantity < 1) {
                showNotification('Введите корректное количество', 'error');
                return;
            }
            
            item.quantity = quantity;
            
            // Обновление текущего пользователя
            currentUser = db.users[userIndex];
            localStorage.setItem('currentUser', JSON.stringify(currentUser));
            
            // Сохранение данных
            saveData();
            
            // Обновление корзины
            loadCart();
            
            showNotification('Количество товара обновлено', 'success');
        }
        
        // Загрузка профиля
        function loadProfile() {
            if (!currentUser) {
                showNotification('Для просмотра профиля необходимо войти в систему', 'error');
                openAuthModal();
                switchPage('home');
                return;
            }
            
            updateProfileStats();
        }
        
        // Обновление статистики профиля
        function updateProfileStats() {
            if (!currentUser) return;
            
            const favoritesCount = document.getElementById('favorites-count');
            const cartItemsCount = document.getElementById('cart-items-count');
            const comparisonsCount = document.getElementById('comparisons-count');
            const ordersCount = document.getElementById('orders-count');
            
            if (favoritesCount) {
                favoritesCount.textContent = currentUser.favorites ? currentUser.favorites.length : 0;
            }
            
            if (cartItemsCount) {
                cartItemsCount.textContent = currentUser.cart ? currentUser.cart.length : 0;
            }
            
            if (comparisonsCount) {
                comparisonsCount.textContent = currentUser.comparisons || 0;
            }
            
            if (ordersCount) {
                ordersCount.textContent = currentUser.orders ? currentUser.orders.length : 0;
            }
        }
        
        // Загрузка админ-панели
        function loadAdminPage() {
            if (!currentUser || currentUser.role !== 'admin') {
                showNotification('У вас нет доступа к админ-панели', 'error');
                switchPage('home');
                return;
            }
            
            loadProductsForAdmin();
        }
        
        // Загрузка товаров для админ-панели
        function loadProductsForAdmin() {
            const adminProductsTable = document.getElementById('admin-products-table');
            if (!adminProductsTable) return;
            
            adminProductsTable.innerHTML = '';
            
            db.products.forEach(product => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${product.id}</td>
                    <td>${product.name}</td>
                    <td>${getCategoryName(product.category)}</td>
                    <td>${product.prices.ozon ? product.prices.ozon.toLocaleString() + ' руб.' : '-'}</td>
                    <td>${product.prices.wb ? product.prices.wb.toLocaleString() + ' руб.' : '-'}</td>
                    <td>${product.prices.dns ? product.prices.dns.toLocaleString() + ' руб.' : '-'}</td>
                    <td>
                        <button class="action-btn action-btn-edit edit-product-btn" data-id="${product.id}">Редактировать</button>
                        <button class="action-btn action-btn-delete delete-product-btn" data-id="${product.id}">Удалить</button>
                    </td>
                `;
                
                adminProductsTable.appendChild(row);
                
                // Обработчики событий для кнопок редактирования и удаления
                const editBtn = row.querySelector('.edit-product-btn');
                editBtn.addEventListener('click', function() {
                    editProduct(product.id);
                });
                
                const deleteBtn = row.querySelector('.delete-product-btn');
                deleteBtn.addEventListener('click', function() {
                    deleteProduct(product.id);
                });
            });
        }
        
        // Загрузка пользователей для админ-панели
        function loadUsersForAdmin() {
            const adminUsersTable = document.getElementById('admin-users-table');
            if (!adminUsersTable) return;
            
            adminUsersTable.innerHTML = '';
            
            db.users.forEach(user => {
                const row = document.createElement('tr');
                const registrationDate = new Date(user.registrationDate);
                const formattedDate = registrationDate.toLocaleDateString('ru-RU');
                
                row.innerHTML = `
                    <td>${user.id}</td>
                    <td>${user.name}</td>
                    <td>${user.email}</td>
                    <td>${user.role === 'admin' ? 'Администратор' : 'Пользователь'}</td>
                    <td>${formattedDate}</td>
                    <td>
                        <button class="action-btn action-btn-edit edit-user-btn" data-id="${user.id}">Редактировать</button>
                        <button class="action-btn action-btn-delete delete-user-btn" data-id="${user.id}" ${user.role === 'admin' ? 'disabled' : ''}>Удалить</button>
                    </td>
                `;
                
                adminUsersTable.appendChild(row);
                
                // Обработчики событий для кнопок редактирования и удаления
                const editBtn = row.querySelector('.edit-user-btn');
                editBtn.addEventListener('click', function() {
                    editUser(user.id);
                });
                
                const deleteBtn = row.querySelector('.delete-user-btn');
                if (!user.role === 'admin') {
                    deleteBtn.addEventListener('click', function() {
                        deleteUser(user.id);
                    });
                }
            });
        }
        
        // Загрузка статистики
        function loadStatistics() {
            document.getElementById('total-users').textContent = db.statistics.totalUsers;
            document.getElementById('total-products').textContent = db.statistics.totalProducts;
            document.getElementById('total-favorites').textContent = db.statistics.totalFavorites;
            document.getElementById('total-cart-adds').textContent = db.statistics.totalCartAdds;
        }
        
        // Открытие модального окна товара
        function openProductModal(productId = null) {
            const productModal = document.getElementById('product-modal');
            const productModalTitle = document.getElementById('product-modal-title');
            const productForm = document.getElementById('product-form');
            const saveProductBtn = document.getElementById('save-product-btn');
            
            // Сброс формы
            productForm.reset();
            
            if (productId) {
                // Редактирование существующего товара
                productModalTitle.textContent = 'Редактировать товар';
                saveProductBtn.textContent = 'Сохранить изменения';
                saveProductBtn.setAttribute('data-id', productId);
                
                const product = db.products.find(p => p.id === productId);
                if (product) {
                    document.getElementById('product-name').value = product.name;
                    document.getElementById('product-category').value = product.category;
                    document.getElementById('product-price-ozon').value = product.prices.ozon || '';
                    document.getElementById('product-price-wb').value = product.prices.wb || '';
                    document.getElementById('product-price-dns').value = product.prices.dns || '';
                    document.getElementById('product-description').value = product.description || '';
                }
            } else {
                // Добавление нового товара
                productModalTitle.textContent = 'Добавить товар';
                saveProductBtn.textContent = 'Сохранить товар';
                saveProductBtn.removeAttribute('data-id');
            }
            
            productModal.classList.add('active');
        }
        
        // Сохранение товара
        function saveProduct() {
            const productId = document.getElementById('save-product-btn').getAttribute('data-id');
            const name = document.getElementById('product-name').value.trim();
            const category = document.getElementById('product-category').value;
            const priceOzon = parseInt(document.getElementById('product-price-ozon').value) || 0;
            const priceWb = parseInt(document.getElementById('product-price-wb').value) || 0;
            const priceDns = parseInt(document.getElementById('product-price-dns').value) || 0;
            const description = document.getElementById('product-description').value.trim();
            
            // Валидация
            if (!name) {
                document.getElementById('product-name-error').classList.add('active');
                return;
            } else {
                document.getElementById('product-name-error').classList.remove('active');
            }
            
            if (productId) {
                // Редактирование существующего товара
                const id = parseInt(productId);
                const index = db.products.findIndex(p => p.id === id);
                
                if (index !== -1) {
                    db.products[index] = {
                        ...db.products[index],
                        name,
                        category,
                        description,
                        prices: {
                            ozon: priceOzon,
                            wb: priceWb,
                            dns: priceDns
                        }
                    };
                    
                    showNotification('Товар обновлен', 'success');
                }
            } else {
                // Добавление нового товара
                const newProduct = {
                    id: db.products.length > 0 ? Math.max(...db.products.map(p => p.id)) + 1 : 1,
                    name,
                    category,
                    description,
                    prices: {
                        ozon: priceOzon,
                        wb: priceWb,
                        dns: priceDns
                    },
                    addedDate: new Date().toISOString()
                };
                
                db.products.push(newProduct);
                db.statistics.totalProducts++;
                
                showNotification('Товар добавлен', 'success');
            }
            
            // Сохранение данных
            saveData();
            
            // Закрытие модального окна
            document.getElementById('product-modal').classList.remove('active');
            
            // Обновление таблицы товаров в админ-панели
            loadProductsForAdmin();
            
            // Обновление списка товаров на главной странице
            loadProducts();
        }
        
        // Редактирование товара
        function editProduct(productId) {
            openProductModal(productId);
        }
        
        // Удаление товара
        function deleteProduct(productId) {
            if (!confirm('Вы уверены, что хотите удалить этот товар?')) {
                return;
            }
            
            const index = db.products.findIndex(p => p.id === productId);
            
            if (index !== -1) {
                // Удаление товара из избранного у всех пользователей
                db.users.forEach(user => {
                    if (user.favorites) {
                        const favIndex = user.favorites.indexOf(productId);
                        if (favIndex !== -1) {
                            user.favorites.splice(favIndex, 1);
                        }
                    }
                    
                    // Удаление товара из корзины у всех пользователей
                    if (user.cart) {
                        const cartIndex = user.cart.findIndex(item => item.id === productId);
                        if (cartIndex !== -1) {
                            user.cart.splice(cartIndex, 1);
                        }
                    }
                });
                
                // Удаление товара
                db.products.splice(index, 1);
                
                // Сохранение данных
                saveData();
                
                // Обновление таблицы товаров в админ-панели
                loadProductsForAdmin();
                
                // Обновление списка товаров на главной странице
                loadProducts();
                
                // Обновление избранного и корзины, если они открыты
                if (document.getElementById('favorites-page').classList.contains('active')) {
                    loadFavorites();
                }
                
                if (document.getElementById('cart-page').classList.contains('active')) {
                    loadCart();
                }
                
                showNotification('Товар удален', 'success');
            }
        }
        
        // Редактирование пользователя
        function editUser(userId) {
            alert('Редактирование пользователей будет доступно в следующей версии!');
        }
        
        // Удаление пользователя
        function deleteUser(userId) {
            if (!confirm('Вы уверены, что хотите удалить этого пользователя?')) {
                return;
            }
            
            const user = db.users.find(u => u.id === userId);
            
            if (!user || user.role === 'admin') {
                showNotification('Невозможно удалить администратора', 'error');
                return;
            }
            
            const index = db.users.findIndex(u => u.id === userId);
            
            if (index !== -1) {
                // Если удаляемый пользователь - текущий, выполнить выход
                if (currentUser && currentUser.id === userId) {
                    logout();
                }
                
                // Удаление пользователя
                db.users.splice(index, 1);
                db.statistics.totalUsers--;
                
                // Сохранение данных
                saveData();
                
                // Обновление таблицы пользователей в админ-панели
                loadUsersForAdmin();
                
                // Обновление статистики
                loadStatistics();
                
                showNotification('Пользователь удален', 'success');
            }
        }
        
        // Показать уведомление
        function showNotification(message, type = 'info') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification notification-${type}`;
            notification.classList.add('active');
            
            // Скрыть уведомление через 3 секунды
            setTimeout(() => {
                notification.classList.remove('active');
            }, 3000);
        }
        
        // Генерация случайного цвета
        function getRandomColor() {
            const colors = [
                '#3498db', '#2ecc71', '#e74c3c', '#f39c12', 
                '#9b59b6', '#1abc9c', '#d35400', '#34495e'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }
    </script>
</body>
</html>